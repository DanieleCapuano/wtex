!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.wtex=r():e.wtex=r()}(self,(()=>(()=>{"use strict";var __webpack_modules__={880:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{ax:()=>init_program});var _vertex_common__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(961),_uniforms_common__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(286),_utils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(853),_texture_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(370),_program_loop__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(398),init_program=_init_program,init_program_fbos=_init_program_fbos,get_program_data=_get_program_data;function _init_program(e,r){var t={};try{var _=[r.vertex_shader,r.fragment_shader].map((function(e){return _decorate_source(e)}));if(r.build_program)t=r.build_program(e,_);else{var n=(0,_utils__WEBPACK_IMPORTED_MODULE_2__.jr)(e,_);t=_init_program_fbos(Object.assign({program:n},_get_program_data(e,n,_)),e,r)}}catch(e){console.warn("PROGRAM ERROR FOR CURRENT PROGRAM"),console.warn(e)}return t}function _get_program_data(e,r,t){return{vertex_data:(0,_vertex_common__WEBPACK_IMPORTED_MODULE_3__.D)(e,r),uniforms:(0,_uniforms_common__WEBPACK_IMPORTED_MODULE_4__.r)(e,r),shaders:t,start_time:performance.now(),exec_loop:_program_loop__WEBPACK_IMPORTED_MODULE_1__.y}}function _init_program_fbos(e,r,t){var _=t.canvas,n=t.framebuffers_n||1,o=t.framebuffers_offset||1;return e.has_framebuffer=t.has_framebuffer,t.dont_create_base_texture||(e.base_texture=e.base_texture||_texture_common__WEBPACK_IMPORTED_MODULE_0__.K.init_texture(r,0)),e.fbo_data=_texture_common__WEBPACK_IMPORTED_MODULE_0__.K.create_fbo_textures(e,r,n,o,_.clientWidth,_.clientHeight),e}function _decorate_source(source){return eval("`"+source+"`")}},398:(e,r,t)=>{t.d(r,{d:()=>o,y:()=>a});var _=t(853),n=t(370),o=function(e,r){var t=r.gl,n=r.canvas,o=e.uniforms,a=e.program,u=e.vertex_data;return(0,_.Lo)(n),window.addEventListener("resize",(function(){(0,_.Lo)(n),i=!0})),t.useProgram(a),t.bindVertexArray(u.vao),t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),o.u_image.set(t,a,"1i",0),function _(){requestAnimationFrame(_),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),e.exec_loop(e,t,r),i=!1}()},a=function(e,r,t,o){var a=r.base_texture,c=o.framebuffers_offset,f=o.framebuffers_n,m=o.inputElement||document.getElementById(o.inputElementId),s=o.canvas||document.getElementById(o.outputElementId)||t.canvas;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,a),(o.input.isVideo||!u)&&(n.K.draw_into_texture(t,m),u=!0),function(e,r,t){var _=e.uniforms,n=e.program;if(_.u_flip_y&&_.u_flip_y.set(r,n,"1f",1),_.u_time){var o=(performance.now()-e.start_time)/1e3;_.u_time.set(r,n,"1f",o)}i&&_.u_resolution.set(r,n,"2f",[r.canvas.width,r.canvas.height])}(r,t);for(var d=c;d<f+c;++d)n.K.set_framebuffer(t,n.K.get_fbo(r,d),s.clientWidth,s.clientHeight),(0,_.uX)(t),t.bindTexture(t.TEXTURE_2D,n.K.get_fbo_texture(r,d));e(r,t)}.bind(null,(function(e,r){var t=e.uniforms,o=e.program;t.u_flip_y&&t.u_flip_y.set(r,o,"1f",-1),n.K.set_framebuffer(r,null,r.canvas.width,r.canvas.height),(0,_.uX)(r)})),i=!0,u=!1},370:(e,r,t)=>{t.d(r,{K:()=>_});var _=function(){return{init_texture:e,draw_into_texture:r,create_fbo_textures:function(t,_,n,o,a,i){for(var u=[],c=o=o||0;c<n+o;++c){var f=e(_);r(_,null,a,i);var m=_.createFramebuffer();_.bindFramebuffer(_.FRAMEBUFFER,m);var s=_.COLOR_ATTACHMENT0;_.framebufferTexture2D(_.FRAMEBUFFER,s,_.TEXTURE_2D,f,0),u[c]={fbo:m,texture:f}}return u},set_framebuffer:function(e,r,t,_){e.bindFramebuffer(e.FRAMEBUFFER,r),e.viewport(0,0,t,_)},get_fbo_texture:function(e,r){return e.fbo_data[r].texture},get_fbo:function(e,r){return e.fbo_data[r].fbo}};function e(e){var r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),r}function r(e,r,t,_){var n=e.RGBA,o=e.RGBA,a=e.UNSIGNED_BYTE,i=r,u=i?[e.TEXTURE_2D,0,n,o,a,i]:[e.TEXTURE_2D,0,n,t,_,0,o,a,i];e.texImage2D.apply(e,u)}}()},286:(e,r,t)=>{t.d(r,{r:()=>n});var _=t(853);function n(e,r){var t=(0,_.Vh)(e,{program:r});return Object.keys(t.uniforms).reduce((function(e,r){return e[r]={get:function(){return t.uniforms[r].loc},set:n.bind(null,t.uniforms[r])},e}),{});function n(e,r,t,_,n){r["uniform"+_].apply(r,[].concat(e.loc,n))}}},853:(e,r,t)=>{t.d(r,{Lo:()=>i,Vh:()=>c,c0:()=>_,jr:()=>a,kQ:()=>n,uX:()=>u});var _=function(e,r,t,_,n){var o=r,a=r+_,i=t,u=t+n;e.bufferData(e.ARRAY_BUFFER,new Float32Array([o,i,a,i,o,u,o,u,a,i,a,u]),e.STATIC_DRAW)},n=function(e,r,t,_,n,o){e.bindBuffer(e.ARRAY_BUFFER,r),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,_,o||e.FLOAT,n||!1,0,0)},o=function(e,r,t,_){var n=_||m,o=e.createShader(t);return e.shaderSource(o,r),e.compileShader(o),e.getShaderParameter(o,e.COMPILE_STATUS)?o:(n("*** Error compiling shader '"+o+"':"+e.getShaderInfoLog(o)),e.deleteShader(o),null)},a=function(e,r,t,_,n){for(var a=[],i=0;i<r.length;++i)a.push(o(e,r[i],e[f[i]],n));return function(e,r,t,_,n){var o=n||m,a=e.createProgram();return r.forEach((function(r){e.attachShader(a,r)})),t&&t.forEach((function(r,t){e.bindAttribLocation(a,_?_[t]:t,r)})),e.linkProgram(a),e.getProgramParameter(a,e.LINK_STATUS)?a:(o("Error in program linking:"+e.getProgramInfoLog(a)),e.deleteProgram(a),null)}(e,a,t,_,n)},i=function(e,r){r=r||1;var t=e.clientWidth*r|0,_=e.clientHeight*r|0;return(e.width!==t||e.height!==_)&&(e.width=t,e.height=_,!0)},u=function(e,r,t,_){var n=s(r)||e.TRIANGLES,o=s(t)||0,a=s(_)||6;e.drawArrays(n,o,a)},c=function(e,r){var t=r.program;r.attributes={},r.uniforms={};for(var _=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),n=r.attributes,o=0;o<_;o++){var a=e.getActiveAttrib(t,o);n[a.name]={loc:e.getAttribLocation(t,a.name),def:a}}var i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);n=r.uniforms;for(var u=0;u<i;u++){var c=e.getActiveUniform(t,u);n[c.name]={loc:e.getUniformLocation(t,c.name),def:c}}return r},f=["VERTEX_SHADER","FRAGMENT_SHADER"];function m(e){window.top.console&&(window.top.console.error?window.top.console.error(e):window.top.console.log&&window.top.console.log(e))}function s(e){return null!=e?e:null}},961:(e,r,t)=>{t.d(r,{D:()=>n});var _=t(853),n=function(e,r){var t={};return t.vao=e.createVertexArray(),e.bindVertexArray(t.vao),t.positionAttributeLocation=e.getAttribLocation(r,"a_position"),t.texCoodAttributeLocation=e.getAttribLocation(r,"a_texCoord"),t.pos_buffer=e.createBuffer(),t.coord_buffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t.pos_buffer),(0,_.c0)(e,0,0,e.canvas.clientWidth,e.canvas.clientHeight),(0,_.kQ)(e,t.pos_buffer,t.positionAttributeLocation,2),e.bindBuffer(e.ARRAY_BUFFER,t.coord_buffer),(0,_.c0)(e,0,0,1,1),(0,_.kQ)(e,t.coord_buffer,t.texCoodAttributeLocation,2,!0),e.bindVertexArray(null),t}}},__webpack_module_cache__={};function __webpack_require__(e){var r=__webpack_module_cache__[e];if(void 0!==r)return r.exports;var t=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](t,t.exports,__webpack_require__),t.exports}__webpack_require__.d=(e,r)=>{for(var t in r)__webpack_require__.o(r,t)&&!__webpack_require__.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},__webpack_require__.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>_,texturize:()=>t});var e=__webpack_require__(880),r=__webpack_require__(398),t=function(t){var _=t.vertex_shader,o=t.fragment_shader,a=t.config_path,i=t.WIN_LOADED;return new Promise((function(t){var u=function(){(function(e){return new Promise((function(r){fetch(e).then((function(e){return e.json()})).then((function(e){return r(e)}))}))})(a||"/config/config.json").then((function(a){var i;(i=Object.assign(a,{vertex_shader:_,fragment_shader:o}),function(e){var r=e.input,t=e.output;return Promise.all([{conf:r,type:"input"},{conf:t,type:"output"}].map((function(e){return new Promise((function(r){var t=e.conf||{},_=t.domQuery,n=t.imagePath;if(_)return e.elem=document.querySelector(_),r(e);n?(e.elem=new Image,e.elem.src=n,e.elem.addEventListener("load",r.bind(null,e))):r(e)}))})))}(i).then((function(t){var _=t.find((function(e){return"output"===e.type})).elem,o=t.find((function(e){return"input"===e.type})).elem,a=_.getContext("webgl2",{desynchronized:!0,powerPreference:"high-performance"});if(a)return i=Object.assign({},i,{gl:a,canvas:_,inputElement:o}),n=(0,e.ax)(a,i),(0,r.d)(n,i)}))).then(t)}))};i&&u(),window.addEventListener("load",u)}))};const _=t;var n={}})(),__webpack_exports__})()));